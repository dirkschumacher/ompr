<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ompr">
<title>The Warehouse Location Problem • ompr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The Warehouse Location Problem">
<meta property="og:description" content="ompr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ompr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dirkschumacher/ompr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/dirk_sch">
    <span class="fa fa-lg fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="problem-warehouse-location_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>The Warehouse Location Problem</h1>
                        <h4 data-toc-skip class="author">Dirk Schumacher</h4>
            
            <h4 data-toc-skip class="date">2017-04-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dirkschumacher/ompr/blob/HEAD/vignettes/problem-warehouse-location.Rmd" class="external-link"><code>vignettes/problem-warehouse-location.Rmd</code></a></small>
      <div class="d-none name"><code>problem-warehouse-location.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this article we will look at the <a href="https://en.wikipedia.org/wiki/Facility_location_problem" class="external-link">Warehouse Location Problem</a>. Given a set of customers and set of locations to build warehoses the task is to decide where to build warehouses and from what warehouses goods should be shipped to which customer.</p>
<p>Thus there are two decisions that need to made at once: where and if to build warehouses and the assignment of customers to warehouses. This simple setting also implies that at least one warehouse must be built and that any warehouse is big enough to serve all customers.</p>
<p>As a practical example: you run the logistics for an NGO and want to regularly distribute goods to people in need. You identified a set of possible locations to set up your distribution hubs, but you are not sure where to build them. Then such a model might help. In practice however you might need to incorporate additional constraints into the model.</p>
</div>
<div class="section level2">
<h2 id="the-mathematical-model">The mathematical model<a class="anchor" aria-label="anchor" href="#the-mathematical-model"></a>
</h2>
<p>We start with a set of customers <span class="math inline">\(C = \{1 \ldots n\}\)</span> and a set of possible warehouses <span class="math inline">\(W = \{1 \ldots m\}\)</span> that could be built. In addition we have a cost function giving us the transportation cost from a warehouse to a customer. Furthermore there is a fixed cost associated with each warehouse if it will be built. This basic version of the warehouse location problem is adapted from the <a href="https://de.wikipedia.org/wiki/Warehouse_Location_Problem" class="external-link">German Wikipedia page</a> about the problem.</p>
<p><span class="math display">\[
\begin{equation*}
\begin{array}{ll@{}ll}
\text{min}  &amp; \displaystyle\sum\limits_{i=1}^{n}\sum\limits_{j=1}^{m}\operatorname{transportcost}_{i,j} \cdot x_{i, j} +  \sum\limits_{j=1}^{m}\operatorname{fixedcost}_{j} \cdot y_{j}&amp; &amp;\\
\text{subject to} &amp; \displaystyle\sum\limits_{j=1}^{m}   x_{i, j} = 1  &amp; i=1 ,\ldots, n&amp;\\
                  &amp; \displaystyle x_{i, j} \leq y_j,  &amp; i=1 ,\ldots, n &amp; j=1 ,\ldots, m&amp;\\
                 &amp;                                                x_{i,j} \in \{0,1\} &amp;i=1 ,\ldots, n, &amp; j=1 ,\ldots, m \\
                 &amp;                                                y_{j} \in \{0,1\} &amp;j=1 ,\ldots, m&amp;
\end{array}
\end{equation*}
\]</span></p>
</div>
<div class="section level2">
<h2 id="the-model-in-r">The model in R<a class="anchor" aria-label="anchor" href="#the-model-in-r"></a>
</h2>
<p>The first thing we need is the data. In this article we will simply generate artificial data.</p>
<p>We assume the <strong>customers</strong> are located in a grid with euclidian distances:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">grid_size</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">customer_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="va">grid_size</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="va">grid_size</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>The <strong>warehouses</strong> are also randomly placed on the grid. The fixed cost for the warehouses are randomly generated as well with mean cost of 10,000.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="va">warehouse_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">*</span> <span class="va">grid_size</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">*</span> <span class="va">grid_size</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">fixedcost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span>, mean <span class="op">=</span> <span class="va">grid_size</span> <span class="op">*</span> <span class="fl">10</span>, sd <span class="op">=</span> <span class="va">grid_size</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The fixed costs to set up a warehouse are the following:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fixedcost</span></code></pre></div>
<pre><code><span class="co">##  [1]  9043  6090 20291 13753 19121 10400  6843  2434  6820 11132 15068 11264</span>
<span class="co">## [13]  4140 13344  1749  8171  8419   259 14600  6886</span></code></pre>
<p>Next step is to build a functions that takes a customer and a warehouse and returns the transport cost.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">transportcost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">j</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">customer</span> <span class="op">&lt;-</span> <span class="va">customer_locations</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>
  <span class="va">warehouse</span> <span class="op">&lt;-</span> <span class="va">warehouse_locations</span><span class="op">[</span><span class="va">j</span>, <span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">customer</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="va">warehouse</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">customer</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">warehouse</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">transportcost</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 302</span></code></pre>
<p>Now let’s plot everything. Black dots are customers and red dots are possible warehouse locations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in register(): Can't find generic `scale_type` in package ggplot2 to</span>
<span class="co">## register S3 method.</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">customer_locations</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">warehouse_locations</span>, color <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, shape <span class="op">=</span> <span class="fl">17</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">grid_size</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">grid_size</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, 
        axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, 
        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Warehouse location problem"</span>, 
          <span class="st">"Black dots are customers. Light red triangles show potential warehouse locations."</span><span class="op">)</span></code></pre></div>
<p><img src="problem-warehouse-location_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The model in <code>ompr</code> then looks like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dirkschumacher/ompr" class="external-link">ompr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MIPModel.html">MIPModel</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="co"># 1 iff i gets assigned to warehouse j</span>
  <span class="fu"><a href="../reference/add_variable.html">add_variable</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  
  <span class="co"># 1 iff warehouse j is built</span>
  <span class="fu"><a href="../reference/add_variable.html">add_variable</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  
  <span class="co"># maximize the preferences</span>
  <span class="fu"><a href="../reference/set_objective.html">set_objective</a></span><span class="op">(</span><span class="fu"><a href="../reference/sum_over.html">sum_over</a></span><span class="op">(</span><span class="fu">transportcost</span><span class="op">(</span><span class="va">i</span>, <span class="va">j</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">+</span> 
                  <span class="fu"><a href="../reference/sum_over.html">sum_over</a></span><span class="op">(</span><span class="va">fixedcost</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span>, <span class="st">"min"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  
  <span class="co"># every customer needs to be assigned to a warehouse</span>
  <span class="fu"><a href="../reference/add_constraint.html">add_constraint</a></span><span class="op">(</span><span class="fu"><a href="../reference/sum_over.html">sum_over</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  
  <span class="co"># if a customer is assigned to a warehouse, then this warehouse must be built</span>
  <span class="fu"><a href="../reference/add_constraint.html">add_constraint</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">y</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, j <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">m</span><span class="op">)</span>
<span class="va">model</span></code></pre></div>
<pre><code><span class="co">## Mixed integer linear optimization problem</span>
<span class="co">## Variables:</span>
<span class="co">##   Continuous: 0 </span>
<span class="co">##   Integer: 0 </span>
<span class="co">##   Binary: 2020 </span>
<span class="co">## Model sense: minimize </span>
<span class="co">## Constraints: 2100</span></code></pre>
</div>
<div class="section level2">
<h2 id="solve-the-model">Solve the model<a class="anchor" aria-label="anchor" href="#solve-the-model"></a>
</h2>
<p>We will use <code>glpk</code> to solve the above model.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dirkschumacher/ompr.roi" class="external-link">ompr.roi</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://roi.r-forge.r-project.org/" class="external-link">ROI.plugin.glpk</a></span><span class="op">)</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve_model.html">solve_model</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu"><a href="https://rdrr.io/pkg/ompr.roi/man/with_ROI.html" class="external-link">with_ROI</a></span><span class="op">(</span>solver <span class="op">=</span> <span class="st">"glpk"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## &lt;SOLVER MSG&gt;  ----</span>
<span class="co">## GLPK Simplex Optimizer, v4.65</span>
<span class="co">## 2100 rows, 2020 columns, 6000 non-zeros</span>
<span class="co">##       0: obj =   0.000000000e+00 inf =   1.000e+02 (100)</span>
<span class="co">##     120: obj =   5.223300000e+04 inf =   0.000e+00 (0)</span>
<span class="co">## Perturbing LP to avoid stalling [322]...</span>
<span class="co">## Removing LP perturbation [1058]...</span>
<span class="co">## *  1058: obj =   3.322200000e+04 inf =   0.000e+00 (0) 2</span>
<span class="co">## OPTIMAL LP SOLUTION FOUND</span>
<span class="co">## GLPK Integer Optimizer, v4.65</span>
<span class="co">## 2100 rows, 2020 columns, 6000 non-zeros</span>
<span class="co">## 2020 integer variables, all of which are binary</span>
<span class="co">## Integer optimization begins...</span>
<span class="co">## Long-step dual simplex will be used</span>
<span class="co">## +  1058: mip =     not found yet &gt;=              -inf        (1; 0)</span>
<span class="co">## +  1058: &gt;&gt;&gt;&gt;&gt;   3.322200000e+04 &gt;=   3.322200000e+04   0.0% (1; 0)</span>
<span class="co">## +  1058: mip =   3.322200000e+04 &gt;=     tree is empty   0.0% (0; 1)</span>
<span class="co">## INTEGER OPTIMAL SOLUTION FOUND</span>
<span class="co">## &lt;!SOLVER MSG&gt; ----</span></code></pre>
<p>We solved the problem with an objective value of 33222.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span>
<span class="va">matching</span> <span class="op">&lt;-</span> <span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/get_solution.html">get_solution</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">.9</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">j</span><span class="op">)</span></code></pre></div>
<p>The last step is to add the assignments to the previous plot we generated.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_assignment</span> <span class="op">&lt;-</span> <span class="va">matching</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">customer_locations</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"i"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">warehouse_locations</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"j"</span> <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span><span class="op">)</span>
<span class="va">customer_count</span> <span class="op">&lt;-</span> <span class="va">matching</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">j</span><span class="op">)</span>
<span class="va">plot_warehouses</span> <span class="op">&lt;-</span> <span class="va">warehouse_locations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>costs <span class="op">=</span> <span class="va">fixedcost</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">customer_count</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">matching</span><span class="op">$</span><span class="va">j</span><span class="op">)</span><span class="op">)</span>
<span class="va">p</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_assignment</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.y</span>, y <span class="op">=</span> <span class="va">y.y</span>, xend <span class="op">=</span> <span class="va">x.x</span>, yend <span class="op">=</span> <span class="va">y.x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data  <span class="op">=</span> <span class="va">plot_warehouses</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">3</span>, shape <span class="op">=</span> <span class="fl">17</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_label_repel</a></span><span class="op">(</span>data  <span class="op">=</span> <span class="va">plot_warehouses</span>, 
                            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"fixed costs:"</span>, <span class="va">costs</span>, <span class="st">"; customers: "</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>, 
                            size <span class="op">=</span> <span class="fl">2</span>, nudge_y <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Cost optimal warehouse locations and customer assignment"</span><span class="op">)</span>,
          <span class="st">"Big red triangles show warehouses that will be built, light red are unused warehouse locations. 
Dots represent customers served by the respective warehouses."</span><span class="op">)</span></code></pre></div>
<p><img src="problem-warehouse-location_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>The fixed costs for setting up the 4 warehouses is:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fixedcost</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">matching</span><span class="op">$</span><span class="va">j</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 11285</span></code></pre>
</div>
<div class="section level2">
<h2 id="feedback">Feedback<a class="anchor" aria-label="anchor" href="#feedback"></a>
</h2>
<p>Do you have any questions, ideas, comments? Or did you find a mistake? Let’s discuss on <a href="https://github.com/dirkschumacher/ompr/issues" class="external-link">Github</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dirk Schumacher.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
